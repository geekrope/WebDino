<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <script>
        var jumping = false;
        var adjoin = false;
        var salto = false;
        var frame = 0;
        var night = false;
        const ground = 400;
        var frames = 60;
        var jumpHeight = 250;
        var angle = 0;
        var walk1 = new Image();
        var walk2 = new Image();
        var walk3 = new Image();
        var cactus = new Image();
        var currentRes = null;
        var resInd = 0;
        var tick = 0;
        var a = 100;
        var speed = 10;
        var score = 0;
        const cactusSpawnX = 1920;
        let cactuses = [];
        var colider = {
            x: 100,
            y: ground,
            width: a,
            height: a
        }
        function LoadResources() {
            walk1.src = "dinoSprites/walk1.png";
            walk2.src = "dinoSprites/walk2.png";
            walk3.src = "dinoSprites/walk3.png";
            cactus.src = "dinoSprites/cactus1.png";
        }
        function Start() {
            cactuses = [];
            LoadResources();
            var cnv = document.getElementById("cnvs");
            document.onkeydown = function (e) {
                if (e.keyCode == "32") {
                    jumping = true;
                }
                if (e.keyCode == "83") {
                    salto = true;
                }
            }
        }
        function Draw() {
            var ctx = document.getElementById("cnvs").getContext('2d');
            if (!night) {
                ctx.fillStyle = "#ffffff";
                ctx.fillRect(0, 0, innerWidth, innerHeight);
            }
            ctx.fillStyle = "#0000ff";
            ctx.fillRect(colider.x, colider.y, colider.width, colider.height);
            ctx.save();
            ctx.translate(colider.x + colider.width / 2, colider.y + colider.height / 2);
            ctx.rotate(angle / 180 * Math.PI);
            ctx.translate(-colider.x - colider.width / 2, -colider.y - colider.height / 2);
            ctx.drawImage(currentRes, colider.x, colider.y, currentRes.width / currentRes.height * colider.height, colider.height);
            ctx.restore();
            for (var index = 0; index < cactuses.length; index++) {
                ctx.drawImage(cactus, cactuses[index].x, cactuses[index].y, cactus.width / cactus.height * cactuses[index].height, cactuses[index].height);
            }
            ctx.fillStyle = "#000000";
            ctx.font = "24px ScoreFont";
            ctx.fillText(score.toString(), 0, 24);
        }
        function Jump() {
            if (jumping) {
                frame++;
                colider.y = ground + Math.abs(Math.pow((frame - frames / 2) / (frames / 2) * Math.sqrt(jumpHeight), 2)) - jumpHeight;
                if (frame >= frames) {
                    frame = 0;
                    jumping = false;
                }
                Draw();
            }
        }
        function Salto() {
            if (salto) {
                var ctx = document.getElementById("cnvs").getContext('2d');
                frame++;
                angle += 360 / frames;
                if (frame >= frames) {
                    frame = 0;
                    salto = false;
                    angle = 0;
                }
                colider.y = ground + Math.abs(Math.pow((frame - frames / 2) / (frames / 2) * Math.sqrt(jumpHeight), 2)) - jumpHeight;
                Draw();
            }
        }
        function AddCactus(height, cactusSpawnx) {
            var cactus2 = {
                x: cactusSpawnx,
                y: ground + (1-height/a)*a,
                width: height * cactus.width / cactus.height,
                height: height
            }
            cactuses.push(cactus2);
        }
        function GetCactusWidth(height) {
            return height * cactus.width / cactus.height;
        }
        function Update() {
            var rand = Math.random();
            if (rand > 0.19 && rand < 0.2) {
                var rand2 = Math.random();
                if (cactuses.length == 0) {
                    if (rand2 < 0.33) {
                        AddCactus(a, cactusSpawnX);
                    }
                    if (rand2 > 0.33 && rand2 < 0.66) {
                        AddCactus(a, cactusSpawnX);
                        AddCactus(a / 1.5, cactusSpawnX + GetCactusWidth(a)+10);
                    }
                    else {
                        AddCactus(a/1.25, cactusSpawnX - GetCactusWidth(a/1.25)-10);
                        AddCactus(a, cactusSpawnX);
                        AddCactus(a / 1.5, cactusSpawnX + GetCactusWidth(a)+10);
                    }
                }
                if (cactuses.length > 0) {
                    if (cactusSpawnX - cactuses[cactuses.length - 1].x > speed * 100) {
                        if (rand2 < 0.33) {
                            AddCactus(a, cactusSpawnX);
                        }
                        if (rand2 > 0.33 && rand2 < 0.66) {
                            AddCactus(a, cactusSpawnX);
                            AddCactus(a / 1.5, cactusSpawnX + GetCactusWidth(a) + 10);
                        }
                        else {
                            AddCactus(a / 1.25, cactusSpawnX - GetCactusWidth(a / 1.25) - 10);
                            AddCactus(a, cactusSpawnX);
                            AddCactus(a / 1.5, cactusSpawnX + GetCactusWidth(a) + 10);
                        }
                    }
                }
            }
            for (var index = 0; index < cactuses.length; index++) {
                cactuses[index].x -= speed;
                if (cactuses[index].x + cactuses[index].width < 0) {
                    cactuses.splice(index, 1);
                }
            }
            if (tick % 5 == 0)
            {
                score += 1;
            }
            if (!jumping && !salto && !adjoin) {
                if (resInd % 3 == 0 && tick % 5 == 0) {
                    currentRes = walk1;
                    resInd++;
                }
                if (resInd % 1 == 0 && tick % 5 == 0) {
                    currentRes = walk2;
                    resInd++;
                }
                if (resInd % 2 == 0 && tick % 5 == 0) {
                    currentRes = walk3;
                    resInd++;
                }
                Draw();
            }
            else {
                currentRes = walk1;
                Salto();
                Jump();
                resInd = 0;
            }
            tick++;
        }
        setInterval(Update, 10);
    </script>
    <style>
        @font-face {
            src: url("res/PressStart2P-Regular.ttf");
            font-family:ScoreFont;
        }
    </style>
</head>
<body onload="Start()" style="overflow:hidden">
    <canvas width="1920" height="1080" id="cnvs" />
</body>
</html>